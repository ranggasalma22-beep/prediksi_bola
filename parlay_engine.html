<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Neutral Football Analysis Engine – FINAL</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{background:#05070b;color:#eaeaea;font-family:Arial;padding:16px}
h1,h3{color:#66fcf1;margin-top:0}
.section{background:#0f1420;border:1px solid #333;border-radius:8px;padding:14px;margin-bottom:16px}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
label{display:block;margin-top:8px;font-size:13px;color:#9ff}
textarea,select{width:100%;padding:8px;background:#1a2030;border:1px solid #555;color:#fff;border-radius:6px;font-family:monospace;font-size:13px}
textarea{height:64px}
button{width:100%;padding:14px;background:#66fcf1;border:none;border-radius:8px;font-weight:bold;font-size:15px;cursor:pointer;margin-top:10px}
#out{height:420px;background:#020304;color:#00ff88}
@media(max-width:700px){.grid{grid-template-columns:1fr}}
</style>
</head>

<body>
<h1>Neutral Football Analysis Engine</h1>

<div class="section">
<h3>Match Info</h3>
<label>Match Type</label>
<select id="matchType">
  <option value="league">League</option>
  <option value="big">Big Match</option>
  <option value="knockout">Knockout</option>
  <option value="final">Final</option>
</select>

<label>OU Line</label>
<select id="ouLine">
  <option value="2">2.0</option>
  <option value="2.25">2.25</option>
  <option value="2.5" selected>2.5</option>
  <option value="2.75">2.75</option>
  <option value="3">3.0</option>
</select>
</div>

<div class="section">
<h3>RAW DATA INPUT – HOME vs AWAY (Last Matches)</h3>
<div class="grid">
<div>
<h3>HOME</h3>
<label>xG</label><textarea id="xgH"></textarea>
<label>xGA</label><textarea id="xgaH"></textarea>
<label>Goals For</label><textarea id="gfH"></textarea>
<label>Goals Against</label><textarea id="gaH"></textarea>
<label>Shots on Target</label><textarea id="sotH"></textarea>
</div>
<div>
<h3>AWAY</h3>
<label>xG</label><textarea id="xgA"></textarea>
<label>xGA</label><textarea id="xgaA"></textarea>
<label>Goals For</label><textarea id="gfA"></textarea>
<label>Goals Against</label><textarea id="gaA"></textarea>
<label>Shots on Target</label><textarea id="sotA"></textarea>
</div>
</div>
</div>

<button onclick="run()">ANALYZE</button>

<div class="section">
<h3>OUTPUT</h3>
<textarea id="out" readonly></textarea>
</div>

<script>
// ===== UTILITIES =====
const $ = id => document.getElementById(id);
const clamp = (v,a,b)=>Math.max(a,Math.min(b,v));

function parseArr(str){
  return str ? str.split(',').map(x=>Number(x.trim())).filter(Number.isFinite) : [];
}
function avg(a){return a.length ? a.reduce((x,y)=>x+y,0)/a.length : null;}
function summarize(a){return a.length ? {avg:avg(a), n:a.length} : null;}
function poisson(l,k){
  let f=1;
  for(let i=2;i<=k;i++) f*=i;
  return Math.exp(-l)*Math.pow(l,k)/f;
}

// ===== MODIFIERS =====
function sotModifier(sotAvg,xgAvg){
  if(!sotAvg||!xgAvg) return 1;
  const r = sotAvg/(xgAvg*2.5);
  return clamp(1+(r-1)*0.12,0.9,1.12);
}
function finishingProxy(gfAvg,xgAvg){
  if(!gfAvg||!xgAvg) return 1;
  const r = gfAvg/xgAvg;
  if(r>1.3) return 0.92;
  if(r<0.7) return 0.95;
  return 1;
}

// ===== SITUATIONAL =====
function situationalLowBlock(sotAvg,xgAvg,xgGap,matchType,isAway){
  const pressure = ['big','knockout','final'].includes(matchType) || isAway;
  return pressure && xgGap>0.7 && sotAvg!=null && xgAvg!=null && sotAvg<4 && xgAvg>0.9;
}

// ===== CONSTANT =====
const CONFIDENCE_MIN = 58;

// ===== MAIN ENGINE =====
function run(){
 try{
  const home={
    xg:parseArr($('xgH').value),
    xga:parseArr($('xgaH').value),
    gf:parseArr($('gfH').value),
    ga:parseArr($('gaH').value),
    sot:parseArr($('sotH').value)
  };
  const away={
    xg:parseArr($('xgA').value),
    xga:parseArr($('xgaA').value),
    gf:parseArr($('gfA').value),
    ga:parseArr($('gaA').value),
    sot:parseArr($('sotA').value)
  };

  if(home.xg.length<3||away.xg.length<3||home.xga.length<3||away.xga.length<3){
    $('out').value='⚠️ WARNING\nMinimal 3 data xG & xGA untuk HOME dan AWAY';
    return;
  }

  const hxg=summarize(home.xg), axg=summarize(away.xg);
  const hgf=summarize(home.gf), agf=summarize(away.gf);
  const hSOT=summarize(home.sot), aSOT=summarize(away.sot);

  let lamH=hxg.avg, lamA=axg.avg;
  if(hgf) lamH*=finishingProxy(hgf.avg,hxg.avg);
  if(agf) lamA*=finishingProxy(agf.avg,axg.avg);
  if(hSOT) lamH*=sotModifier(hSOT.avg,hxg.avg);
  if(aSOT) lamA*=sotModifier(aSOT.avg,axg.avg);

  lamH=clamp(lamH,0.2,4);
  lamA=clamp(lamA,0.2,4);

  const ouLine = Number($('ouLine').value);
  let overProb=0, dist=[];
  const MAX_GOAL = ['big','knockout','final'].includes($('matchType').value) ? 6 : 5;

  for(let h=0;h<=MAX_GOAL;h++){
    for(let a=0;a<=MAX_GOAL;a++){
      const p=poisson(lamH,h)*poisson(lamA,a);
      dist.push({s:`${h}-${a}`,p});
      if(h+a>ouLine) overProb+=p;
    }
  }

  dist.sort((x,y)=>y.p-x.p);

  const confidence = Math.round(Math.max(
    overProb*100,
    (1-overProb)*100
  ));

  if(confidence < CONFIDENCE_MIN){
    $('out').value=`CONFIDENCE : ${confidence}%\nSTATUS     : NO BET (LOCKED)`;
    return;
  }

  const xgGap=Math.abs(hxg.avg-axg.avg);
  const lowBlock =
    situationalLowBlock(hSOT?hSOT.avg:null,hxg.avg,xgGap,$('matchType').value,false) ||
    situationalLowBlock(aSOT?aSOT.avg:null,axg.avg,xgGap,$('matchType').value,true);

  let hdpLine='HDP Check       : TIDAK DISARANKAN';
  let hdpReason='';
  const lamGap=Math.abs(lamH-lamA);
  if(lamGap>=0.6 && !lowBlock && !['0-0','1-1'].includes(dist[0].s)){
    hdpLine='HDP Check       : COCOK';
    hdpReason=`HDP Condong     : ${lamH>lamA?'HOME':'AWAY'}`;
  }

  $('out').value=
  `HOME λ : ${lamH.toFixed(2)}\nAWAY λ : ${lamA.toFixed(2)}\n\n`+
  `Most Likely Score : ${dist[0].s}\n`+
  `Over ${ouLine} Prob     : ${(overProb*100).toFixed(1)}%\n`+
  (overProb>0.6?'OU Note          : Over condong\n':
   overProb<0.45?'OU Note          : Under lebih aman\n':
   'OU Note          : Zona abu-abu / NO BET\n')+
  (lowBlock?'Low Block        : Situational – tempo ditekan\n':'')+
  hdpLine+'\n'+hdpReason;

 }catch(e){
  $('out').value='ERROR: '+e.message;
 }
}
</script>
</body>
  </html>

  <!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Neutral Market Analysis Engine v1.0</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{background:#05070b;color:#eaeaea;font-family:Arial;padding:20px}
h1,h3{color:#66fcf1}
.section{background:#0f1420;border:1px solid #333;border-radius:6px;padding:14px;margin-bottom:14px}
label{display:block;margin-top:6px;font-size:13px}
input,select{width:100%;padding:6px;background:#1a2030;border:1px solid #555;color:#fff;border-radius:4px}
button{width:100%;padding:12px;margin-top:14px;background:#66fcf1;border:none;border-radius:6px;font-weight:bold;cursor:pointer}
textarea{width:100%;height:520px;background:#020304;color:#00ff88;font-family:monospace;font-size:12px;padding:10px;border:1px solid #333;border-radius:5px}
</style>
</head>

<body>

<h1>Neutral Market Analysis Engine <small>v1.0 FINAL</small></h1>

<div class="section">
<h3>League & Match Type</h3>
<label>League</label>
<select id="league">
<option value=""></option>
<option value="EPL">Premier League</option>
<option value="LL">La Liga</option>
<option value="SA">Serie A</option>
<option value="BL">Bundesliga</option>
<option value="L1">Ligue 1</option>
<option value="MLS">MLS</option>
</select>

<label>Match Type</label>
<select id="matchType">
<option value="league">League</option>
<option value="cup">Cup</option>
<option value="knockout">Knockout</option>
<option value="final">Final</option>
</select>
</div>

<div class="section">
<h3>Match Context (Optional)</h3>
<label>Tempo (1–10)</label><input id="tempo" type="number">
<label>Chaos (1–10)</label><input id="chaos" type="number">
<label>Importance (1–10)</label><input id="importance" type="number">
</div>

<div class="section">
<h3>HOME TEAM</h3>
<label>xG avg (5)</label><input id="xgH" type="number" step="0.01">
<label>xGA avg (5)</label><input id="xgaH" type="number" step="0.01">
<label>Goals For (5)</label><input id="gfH" type="number">
<label>Goals Against (5)</label><input id="gaH" type="number">
<label>Shots on Target / match</label><input id="sotH" type="number" step="0.1">
<label>Defensive Errors (5)</label><input id="errH" type="number">
<label>Clean Sheet Rate (0–1)</label><input id="csH" type="number" step="0.01">
</div>

<div class="section">
<h3>AWAY TEAM</h3>
<label>xG avg (5)</label><input id="xgA" type="number" step="0.01">
<label>xGA avg (5)</label><input id="xgaA" type="number" step="0.01">
<label>Goals For (5)</label><input id="gfA" type="number">
<label>Goals Against (5)</label><input id="gaA" type="number">
<label>Shots on Target / match</label><input id="sotA" type="number" step="0.1">
<label>Defensive Errors (5)</label><input id="errA" type="number">
<label>Clean Sheet Rate (0–1)</label><input id="csA" type="number" step="0.01">
</div>

<button onclick="run()">ANALYZE</button>

<div class="section">
<h3>OUTPUT</h3>
<textarea id="out" readonly></textarea>
</div>

<script>
/* =========================
   HELPERS
========================= */
const g=id=>Number(document.getElementById(id).value)||0;
const s=id=>document.getElementById(id).value;
const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));

/* =========================
   CORE FUNCTIONS
========================= */
function finReg(xg,gpm){
  if(!xg||xg<=0) return xg;
  const r=gpm/xg;
  if(r>1.3) return xg*(0.7+0.3/r);
  if(r<0.7) return xg*(1+(0.7-r)*0.2);
  return xg;
}

function autoImportance(t){
  if(t==="final") return 8;
  if(t==="knockout") return 7;
  if(t==="cup") return 6;
  return 5;
}

function DFI(err,chaos,cs){
  return clamp((Math.min(err/5,1))*0.4+(chaos/10)*0.3+(1-cs)*0.3,0,1);
}

/* =========================
   TIER 1
========================= */
function oaf(oppXGA){
  if(!oppXGA||oppXGA<=0) return 1;
  return clamp(1.15-(oppXGA-1.2)*0.25,0.85,1.15);
}

function trapRisk(lam,cs,chaos){
  let r=0;
  if(lam>1.8 && cs<0.35) r++;
  if(chaos>5) r++;
  return r;
}

function confidenceV2(lh,la,chaos,dfiH,dfiA){
  let c=70;
  const gap=Math.abs(lh-la);
  if(gap>0.8) c+=15;
  else if(gap>0.4) c+=8;
  else c-=10;
  c-=chaos*3;
  c-=(dfiH+dfiA)*10;
  return clamp(c,0,100);
}

/* =========================
   TIER 2
========================= */
function drawGravity(lh,la,tempo,chaos){
  return (Math.abs(lh-la)<0.35 && tempo<5 && chaos<4);
}

/* =========================
   TIER 3
========================= */
function defensiveFloor(dfiH,dfiA){
  return (dfiH+dfiA)>1.1;
}

function tempoMismatch(xg,sot,tempo){
  return (xg>1.6 && sot<4 && tempo<5);
}

/* =========================
   TIER 4
========================= */
function betGate(conf,chaos){
  if(conf<55) return false;
  if(chaos>6 && conf<70) return false;
  return true;
}

function stakeHint(conf,chaos){
  if(conf>75 && chaos<4) return "NORMAL STAKE";
  if(conf>65) return "SMALL STAKE";
  return "MINIMAL / PARLAY ONLY";
}

/* =========================
   ENGINE RUN
========================= */
function run(){
  if(!g("xgH")||!g("xgA")){
    out.value="INPUT xG HOME & AWAY WAJIB";
    return;
  }

  const tempoEff=g("tempo")||5;
  const chaosEff=g("chaos")||4;
  const impEff=g("importance")||autoImportance(s("matchType"));

  const xgH=finReg(g("xgH"),g("gfH")/5);
  const xgA=finReg(g("xgA"),g("gfA")/5);

  let lamH=xgH*oaf(g("xgaA"));
  let lamA=xgA*oaf(g("xgaH"));

  lamH=clamp(lamH,0.2,4);
  lamA=clamp(lamA,0.2,4);

  const dfiH=DFI(g("errH"),chaosEff,g("csH"));
  const dfiA=DFI(g("errA"),chaosEff,g("csA"));

  let conf=confidenceV2(lamH,lamA,chaosEff,dfiH,dfiA);

  if(lamH>lamA){
    if(trapRisk(lamH,g("csH"),chaosEff)>=2) conf-=15;
  }else{
    if(trapRisk(lamA,g("csA"),chaosEff)>=2) conf-=15;
  }

  if(drawGravity(lamH,lamA,tempoEff,chaosEff)) conf-=10;
  if(defensiveFloor(dfiH,dfiA)) conf-=20;

  if(tempoMismatch(xgH,g("sotH"),tempoEff)||
     tempoMismatch(xgA,g("sotA"),tempoEff)) conf-=12;

  conf=clamp(conf,0,100);

  let txt="";
  txt+="AUTO CONTEXT\n";
  txt+="Tempo      : "+tempoEff+"\n";
  txt+="Chaos      : "+chaosEff+"\n";
  txt+="Importance : "+impEff+"\n\n";
  txt+="LAMBDA\n";
  txt+="Home : "+lamH.toFixed(2)+"\n";
  txt+="Away : "+lamA.toFixed(2)+"\n\n";
  txt+="CONFIDENCE : "+conf+" / 100\n";

  if(!betGate(conf,chaosEff)){
    txt+="\nFINAL DECISION : PASS (NO BET)";
    out.value=txt;
    return;
  }

  const diff=lamH-lamA;
  const hdp=diff>=0.75?"HOME -0.5":
            diff>=0.45?"HOME -0.25":
            diff>-0.45?"HDP 0":
            diff>-0.75?"AWAY +0.25":"AWAY -0.5";

  txt+="\nRECOMMENDATION\n";
  txt+="HDP : "+hdp+"\n";
  txt+="STAKE : "+stakeHint(conf,chaosEff);

  out.value=txt;
}
</script>

</body>
                             </html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PSZ LEVEL 1500 - FULL POWER MODE</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #0d1117;
        color: #e6edf3;
        margin: 0;
        padding: 0;
        display: flex;
        height: 100vh;
        overflow: hidden;
    }
    #leftPanel {
        width: 28%;
        background: #161b22;
        padding: 20px;
        overflow-y: auto;
        border-right: 2px solid #30363d;
    }
    #rightPanel {
        flex: 1;
        display: flex;
        flex-direction: column;
        padding: 20px;
        overflow-y: auto;
    }
    .sectionTitle {
        font-size: 18px;
        margin: 20px 0 10px;
        font-weight: bold;
        border-bottom: 1px solid #30363d;
        padding-bottom: 5px;
    }
    select, input {
        width: 100%;
        padding: 6px;
        margin: 6px 0;
        border-radius: 6px;
        border: none;
        background: #21262d;
        color: #e6edf3;
    }
    button {
        width: 100%;
        padding: 10px;
        background: #238636;
        border: none;
        border-radius: 6px;
        margin-top: 12px;
        color: white;
        font-weight: bold;
        cursor: pointer;
    }
    button:hover {
        background: #2ea043;
    }
    #output {
        flex: 1;
        white-space: pre-wrap;
        background: #0d1117;
        border: 1px solid #30363d;
        padding: 10px;
        margin-top: 10px;
        border-radius: 6px;
        overflow-y: auto;
    }
</style>
</head>
<body>

<div id="leftPanel">
    <div class="sectionTitle">Match Input</div>

    <label>Expected Goals (Home)</label>
    <input id="xg_home" type="number" step="0.01">

    <label>Expected Goals (Away)</label>
    <input id="xg_away" type="number" step="0.01">

    <label>Shots (Home)</label>
    <input id="shots_home" type="number">

    <label>Shots (Away)</label>
    <input id="shots_away" type="number">

    <label>SOT (Home)</label>
    <input id="sot_home" type="number">

    <label>SOT (Away)</label>
    <input id="sot_away" type="number">

    <label>Preset Liga</label>
<select id="league_preset">
  <option value="AUTO">Auto Detect</option>

  <optgroup label="Top Leagues">
    <option value="EPL">Premier League (ENG)</option>
    <option value="LALIGA">La Liga (ESP)</option>
    <option value="SERIEA">Serie A (ITA)</option>
    <option value="BUNDES">Bundesliga (GER)</option>
    <option value="LIGUE1">Ligue 1 (FRA)</option>
  </optgroup>

  <optgroup label="Secondary">
    <option value="EREDIV">Eredivisie</option>
    <option value="PRIMEIRA">Primeira Liga</option>
    <option value="MLS">MLS</option>
  </optgroup>

  <optgroup label="Cups / International">
    <option value="UCL">Champions League</option>
    <option value="UEL">Europa League</option>
    <option value="INT">International Match</option>
  </optgroup>
</select>

    <label>Possession Home (%)</label>
    <input id="pos_home" type="number">

    <label>Importance (1–10)</label>
    <input id="importance" type="number" min="1" max="10">

    <div class="sectionTitle">Match Type (57 Types)</div>
    <select id="match_type">
        <!-- Will be filled in PART 2 -->
    </select>

    <button id="runEngine">RUN ANALYSIS</button>
</div>

<div id="rightPanel">
    <div class="sectionTitle">PSZ LEVEL 1500 — RESULT</div>
    <div id="output">Waiting for input…</div>
</div>
<script>
window.PSZ = window.PSZ || {};
(function(PSZ){

/* ========= CORE GUARD ========= */
PSZ.guard = function(cond, msg){
  if(!cond) throw new Error(msg || "Guard failed");
};

PSZ.safeNum = function(v, d){
  v = Number(v);
  return isFinite(v) ? v : d;
};

PSZ.clamp = function(v, min, max){
  if(!isFinite(v)) v = min;
  if(min !== undefined) v = Math.max(min, v);
  if(max !== undefined) v = Math.min(max, v);
  return v;
};

})(window.PSZ);
</script>
<script>
(function(PSZ){

PSZ.LEAGUE_PRESETS = {
  EPL:   { tempo: 6.8, volatility: 0.65, overBias: 0.10, bttsBias: 0.08, riskMod: 0.05, confMin: 55 },
  LALIGA:{ tempo: 6.0, volatility: 0.55, overBias: 0.00, bttsBias: 0.02, riskMod: 0.00, confMin: 55 },
  SERIEA:{ tempo: 5.6, volatility: 0.45, overBias:-0.05, bttsBias:-0.03, riskMod:-0.05, confMin: 60 },
  BUNDES:{ tempo: 6.5, volatility: 0.70, overBias: 0.12, bttsBias: 0.10, riskMod: 0.08, confMin: 55 },
  LIGUE1:{ tempo: 5.4, volatility: 0.50, overBias:-0.08, bttsBias:-0.05, riskMod:-0.05, confMin: 60 },
  UCL:   { tempo: 5.6, volatility: 0.45, overBias:-0.15, bttsBias:-0.10, riskMod:-0.20, confMin: 65, noBetStrict:true },
  UEL:   { tempo: 5.8, volatility: 0.55, overBias:-0.05, bttsBias:-0.03, riskMod:-0.10, confMin: 60 },
  INT:   { tempo: 5.0, volatility: 0.40, overBias:-0.20, bttsBias:-0.15, riskMod:-0.25, confMin: 70, noBetStrict:true },
  AUTO:  { tempo: 5.5, volatility: 0.55, overBias: 0.00, bttsBias: 0.00, riskMod: 0.00, confMin: 60 }
};

PSZ.resolveLeaguePreset = function(key){
  return PSZ.LEAGUE_PRESETS[key] || PSZ.LEAGUE_PRESETS.AUTO;
};

})(window.PSZ);
          </script>
 <script>
(function(PSZ){

PSZ.MATCH_TYPES = {
  LEAGUE_REGULAR: {},
  BIG_MATCH: {},
  DERBY: {},
  FINAL: {},
  CUP_KNOCKOUT: {},
  RELEGATION: {}
};

})(window.PSZ);
 </script>         

<script>
(function(PSZ){
PSZ.guard(PSZ, "PSZ not ready");

PSZ.buildAutoContext = function(){

  const leagueKey = document.getElementById("league_preset")?.value || "AUTO";
  const manualType = document.getElementById("match_type")?.value || "AUTO";

  const homeStr = PSZ.safeNum(document.getElementById("homeStrength")?.value, 5);
  const awayStr = PSZ.safeNum(document.getElementById("awayStrength")?.value, 5);
  const importance = PSZ.safeNum(document.getElementById("importance")?.value, 5);
  const tempoInput = PSZ.safeNum(document.getElementById("tempo")?.value, 5);
  const pressH = PSZ.safeNum(document.getElementById("pressHome")?.value, 5);
  const pressA = PSZ.safeNum(document.getElementById("pressAway")?.value, 5);

  const L = PSZ.resolveLeaguePreset(leagueKey);

  const ctx = {
    base:{
      strHome: homeStr,
      strAway: awayStr,
      imp: importance,
      isFinal: importance >= 9,
      isCup: ["UCL","UEL","INT"].includes(leagueKey),
      relegationPressure: importance >= 8 && Math.abs(homeStr-awayStr)<1
    },
    auto:{
      tempo: PSZ.clamp((tempoInput + L.tempo)/2, 3, 8),
      pressHome: pressH,
      pressAway: pressA,
      volatility: PSZ.clamp((Math.abs(pressH-pressA)/10 + L.volatility)/2, 0.30, 0.85),
      risk: 0
    },
    leaguePreset: leagueKey,
    manualMatchType: manualType,
    matchType: "LEAGUE_REGULAR",
    matchTypeReason: []
  };

  PSZ.applyMatchType(ctx);
  ctx.leagueRiskMod = PSZ.safeNum(L.riskMod,0);

  return ctx;
};

})(window.PSZ);
</script>
<script>
(function(PSZ){

PSZ.applyMatchType = function(ctx){

  if(ctx.manualMatchType && ctx.manualMatchType !== "AUTO"){
    ctx.matchType = ctx.manualMatchType;
    ctx.matchTypeReason.push("Manual match type");
    return;
  }

  if(ctx.base.isFinal){
    ctx.matchType = "FINAL";
    ctx.matchTypeReason.push("High importance final");
    return;
  }

  if(ctx.base.isCup){
    ctx.matchType = "CUP_KNOCKOUT";
    ctx.matchTypeReason.push("Cup competition");
    return;
  }

  if(ctx.base.relegationPressure){
    ctx.matchType = "RELEGATION";
    ctx.matchTypeReason.push("Relegation pressure");
  }
};

})(window.PSZ);
</script>
    <script>
(function(PSZ){

PSZ.runMonteCarlo = function(ctx, opt){
  opt = opt || {};
  const N = opt.N || 8000;
  const CAP = opt.cap || 6;

  const mat = [];
  let total = 0;

  for(let h=0; h<=CAP; h++){
    mat[h]=[];
    for(let a=0; a<=CAP; a++){
      const p = Math.random();
      mat[h][a]=p;
      total+=p;
    }
  }

  return {
    matrix: mat,
    meta:{ N: total, CAP },
    probs:{ pH:0.4, pD:0.3, pA:0.3 },
    BTTS: 0.52,
    avgGoals: 2.65,
    topCS:[{score:"1-1",p:0.12},{score:"2-1",p:0.10}]
  };
};

})(window.PSZ);
    </script>  
    <script>
(function(PSZ){

PSZ.computeOU = function(res){
  const lines=[0.5,1.5,2.5,3.5];
  const out={};
  const mat=res.matrix;
  const CAP=res.meta.CAP;
  const N=res.meta.N;

  lines.forEach(line=>{
    const cut=Math.floor(line);
    let under=0;
    for(let h=0;h<=CAP;h++){
      for(let a=0;a<=CAP;a++){
        if(h+a<=cut) under+=mat[h][a];
      }
    }
    out[line]={ under:under/N, over:1-under/N };
  });

  return out;
};

})(window.PSZ);
    </script>
<script>
(function(PSZ){

PSZ.computeConfidence = function(ctx,res){
  let conf = Math.max(res.probs.pH,res.probs.pD,res.probs.pA)*100;
  conf -= ctx.auto.volatility*15;
  conf -= ctx.auto.risk*10;
  return PSZ.clamp(conf,5,95);
};

})(window.PSZ);
    </script>
<script>
(function(PSZ){

PSZ.buildRecommendation = function(ctx,res,ou,conf){
  return {
    result: conf>=60 ? "PLAY" : "NO BET",
    goals: ou[2.5].over>0.55 ? "OVER 2.5" : "NO BET",
    btts: res.BTTS>0.55 ? "YES" : "NO"
  };
};

PSZ.applyFinalNoBetGate = function(ctx,rec,conf){
  const L = PSZ.resolveLeaguePreset(ctx.leaguePreset);
  const minConf = L.confMin || 60;

  if(conf<minConf){
    return {
      result:"NO BET",
      goals:"NO BET",
      btts:"NO BET",
      noBetReasons:["Low confidence"]
    };
  }
  return rec;
};

})(window.PSZ);
        </script>
  <script>
(function(PSZ){

PSZ.buildOutputText = function(ctx,res){
  const ou = PSZ.computeOU(res);
  const conf = PSZ.computeConfidence(ctx,res);
  let rec = PSZ.buildRecommendation(ctx,res,ou,conf);
  rec = PSZ.applyFinalNoBetGate(ctx,rec,conf);

  let t="";
  t+="PSZ LEVEL 1500 RESULT\n\n";
  t+="Match Type: "+ctx.matchType+"\n";
  t+="Confidence: "+conf.toFixed(1)+"\n\n";
  t+="OU 2.5 Over: "+(ou[2.5].over*100).toFixed(1)+"%\n";
  t+="Result: "+rec.result+"\n";
  t+="Goals: "+rec.goals+"\n";
  t+="BTTS: "+rec.btts+"\n";

  return t;
};

PSZ.runAnalysis = function(){
  const out=document.getElementById("output");
  try{
    const ctx=PSZ.buildAutoContext();
    const res=PSZ.runMonteCarlo(ctx,{});
    out.textContent=PSZ.buildOutputText(ctx,res);
  }catch(e){
    out.textContent="ERROR: "+e.message;
    console.error(e);
  }
};

document.addEventListener("DOMContentLoaded",()=>{
  document.getElementById("runEngine")?.addEventListener("click",PSZ.runAnalysis);
});

})(window.PSZ);
  </script>
    
</body>
</html>

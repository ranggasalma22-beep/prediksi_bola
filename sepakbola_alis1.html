<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PSZ LEVEL 1500 - FULL POWER MODE</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #0d1117;
        color: #e6edf3;
        margin: 0;
        padding: 0;
        display: flex;
        height: 100vh;
        overflow: hidden;
    }
    #leftPanel {
        width: 28%;
        background: #161b22;
        padding: 20px;
        overflow-y: auto;
        border-right: 2px solid #30363d;
    }
    #rightPanel {
        flex: 1;
        display: flex;
        flex-direction: column;
        padding: 20px;
        overflow-y: auto;
    }
    .sectionTitle {
        font-size: 18px;
        margin: 20px 0 10px;
        font-weight: bold;
        border-bottom: 1px solid #30363d;
        padding-bottom: 5px;
    }
    select, input {
        width: 100%;
        padding: 6px;
        margin: 6px 0;
        border-radius: 6px;
        border: none;
        background: #21262d;
        color: #e6edf3;
    }
    button {
        width: 100%;
        padding: 10px;
        background: #238636;
        border: none;
        border-radius: 6px;
        margin-top: 12px;
        color: white;
        font-weight: bold;
        cursor: pointer;
    }
    button:hover {
        background: #2ea043;
    }
    #output {
        flex: 1;
        white-space: pre-wrap;
        background: #0d1117;
        border: 1px solid #30363d;
        padding: 10px;
        margin-top: 10px;
        border-radius: 6px;
        overflow-y: auto;
    }
</style>
</head>
<body>

<div id="leftPanel">
    <div class="sectionTitle">Match Input</div>

    <label>Expected Goals (Home)</label>
    <input id="xg_home" type="number" step="0.01">

    <label>Expected Goals (Away)</label>
    <input id="xg_away" type="number" step="0.01">

    <label>Shots (Home)</label>
    <input id="shots_home" type="number">

    <label>Shots (Away)</label>
    <input id="shots_away" type="number">

    <label>SOT (Home)</label>
    <input id="sot_home" type="number">

    <label>SOT (Away)</label>
    <input id="sot_away" type="number">

    <label>Preset Liga</label>
<select id="league_preset">
  <option value="AUTO">Auto Detect</option>

  <optgroup label="Top Leagues">
    <option value="EPL">Premier League (ENG)</option>
    <option value="LALIGA">La Liga (ESP)</option>
    <option value="SERIEA">Serie A (ITA)</option>
    <option value="BUNDES">Bundesliga (GER)</option>
    <option value="LIGUE1">Ligue 1 (FRA)</option>
  </optgroup>

  <optgroup label="Secondary">
    <option value="EREDIV">Eredivisie</option>
    <option value="PRIMEIRA">Primeira Liga</option>
    <option value="MLS">MLS</option>
  </optgroup>

  <optgroup label="Cups / International">
    <option value="UCL">Champions League</option>
    <option value="UEL">Europa League</option>
    <option value="INT">International Match</option>
  </optgroup>
</select>

    <label>Possession Home (%)</label>
    <input id="pos_home" type="number">

    <label>Importance (1–10)</label>
    <input id="importance" type="number" min="1" max="10">

    <div class="sectionTitle">Match Type (57 Types)</div>
    <select id="match_type">
        <!-- Will be filled in PART 2 -->
    </select>

    <button id="runEngine">RUN ANALYSIS</button>
</div>

<div id="rightPanel">
    <div class="sectionTitle">PSZ LEVEL 1500 — RESULT</div>
    <div id="output">Waiting for input…</div>
</div>
<script>
window.PSZ = window.PSZ || {};
(function(PSZ){

PSZ.guard = function(cond,msg){
  if(!cond) throw new Error(msg||"Guard failed");
};

PSZ.safeNum = function(v,d){
  v = Number(v);
  return Number.isFinite(v) ? v : d;
};

PSZ.clamp = function(v,min,max){
  if(!Number.isFinite(v)) v=min;
  if(min!==undefined) v=Math.max(min,v);
  if(max!==undefined) v=Math.min(max,v);
  return v;
};

})(window.PSZ);
</script>
<script>
(function(PSZ){

PSZ.LEAGUE_PRESETS = {
  EPL:{tempo:6.8,volatility:0.65,overBias:0.10,bttsBias:0.08,riskMod:0.05,confMin:55},
  LALIGA:{tempo:6.0,volatility:0.55,overBias:0.00,bttsBias:0.02,riskMod:0.00,confMin:55},
  SERIEA:{tempo:5.6,volatility:0.45,overBias:-0.05,bttsBias:-0.03,riskMod:-0.05,confMin:60},
  BUNDES:{tempo:6.5,volatility:0.70,overBias:0.12,bttsBias:0.10,riskMod:0.08,confMin:55},
  LIGUE1:{tempo:5.4,volatility:0.50,overBias:-0.08,bttsBias:-0.05,riskMod:-0.05,confMin:60},
  EREDIV:{tempo:6.7,volatility:0.68,overBias:0.12,bttsBias:0.10,riskMod:0.05,confMin:55},
  PRIMEIRA:{tempo:5.8,volatility:0.52,overBias:-0.02,bttsBias:0.00,riskMod:0.00,confMin:58},
  MLS:{tempo:6.9,volatility:0.75,overBias:0.15,bttsBias:0.12,riskMod:0.10,confMin:55},
  UCL:{tempo:5.6,volatility:0.45,overBias:-0.15,bttsBias:-0.10,riskMod:-0.20,confMin:65},
  UEL:{tempo:5.8,volatility:0.55,overBias:-0.05,bttsBias:-0.03,riskMod:-0.10,confMin:60},
  INT:{tempo:5.0,volatility:0.40,overBias:-0.20,bttsBias:-0.15,riskMod:-0.25,confMin:70},
  AUTO:{tempo:5.5,volatility:0.55,overBias:0,bttsBias:0,riskMod:0,confMin:60}
};

PSZ.resolveLeaguePreset = key =>
  PSZ.LEAGUE_PRESETS[key] || PSZ.LEAGUE_PRESETS.AUTO;

})(window.PSZ);
</script>
<script>
(function(PSZ){

PSZ.MATCH_TYPES = {
  LEAGUE_REGULAR:{},
  DERBY:{},
  FINAL:{},
  CUP_KNOCKOUT:{},
  RELEGATION:{}
};

document.addEventListener("DOMContentLoaded",()=>{
  const sel=document.getElementById("match_type");
  if(!sel) return;
  sel.innerHTML='<option value="AUTO">AUTO</option>';
  Object.keys(PSZ.MATCH_TYPES).forEach(k=>{
    const o=document.createElement("option");
    o.value=k; o.textContent=k;
    sel.appendChild(o);
  });
});

})(window.PSZ);
</script>
<script>
(function(PSZ){

PSZ.buildAutoContext = function(){

  const leagueKey = document.getElementById("league_preset")?.value || "AUTO";
  const manualType = document.getElementById("match_type")?.value || "AUTO";

  const xgH = PSZ.safeNum(document.getElementById("xg_home")?.value,1.2);
  const xgA = PSZ.safeNum(document.getElementById("xg_away")?.value,1.0);
  const shH = PSZ.safeNum(document.getElementById("shots_home")?.value,10);
  const shA = PSZ.safeNum(document.getElementById("shots_away")?.value,9);
  const posH = PSZ.safeNum(document.getElementById("pos_home")?.value,50);
  const imp  = PSZ.safeNum(document.getElementById("importance")?.value,5);

  const homeStr = PSZ.clamp(xgH*2.5,1,9);
  const awayStr = PSZ.clamp(xgA*2.5,1,9);
  const tempo   = PSZ.clamp((shH+shA)/6,3,8);
  const pressH  = PSZ.clamp(posH/10,3,7);
  const pressA  = PSZ.clamp((100-posH)/10,3,7);

  const L = PSZ.resolveLeaguePreset(leagueKey);

  const ctx = {
    base:{
      strHome:homeStr,
      strAway:awayStr,
      imp:imp,
      isFinal:imp>=9,
      isCup:["UCL","UEL","INT"].includes(leagueKey),
      relegationPressure:imp>=8 && Math.abs(homeStr-awayStr)<1
    },
    auto:{
      tempo:PSZ.clamp((tempo+L.tempo)/2,3,8),
      volatility:PSZ.clamp((Math.abs(pressH-pressA)/10+L.volatility)/2,0.3,0.85)
    },
    leaguePreset:leagueKey,
    manualMatchType:manualType,
    matchType:"LEAGUE_REGULAR",
    matchTypeReason:[]
  };

  PSZ.applyMatchType(ctx);
  ctx.leagueRiskMod = L.riskMod||0;
  return ctx;
};

})(window.PSZ);
</script>
<script>
(function(PSZ){

PSZ.applyMatchType = function(ctx){
  if(ctx.manualMatchType!=="AUTO"){
    ctx.matchType=ctx.manualMatchType;
    ctx.matchTypeReason.push("Manual override");
    return;
  }
  if(ctx.base.isFinal){
    ctx.matchType="FINAL"; ctx.matchTypeReason.push("Final match"); return;
  }
  if(ctx.base.isCup){
    ctx.matchType="CUP_KNOCKOUT"; ctx.matchTypeReason.push("Cup competition"); return;
  }
  if(ctx.base.relegationPressure){
    ctx.matchType="RELEGATION"; ctx.matchTypeReason.push("Relegation battle");
  }
};

})(window.PSZ);
</script>
<script>
(function(PSZ){

function poisson(lambda){
  let L=Math.exp(-lambda),p=1,k=0;
  do{ k++; p*=Math.random(); }while(p>L);
  return k-1;
}

PSZ.runMonteCarlo = function(ctx,opt){
  opt=opt||{};
  const N=opt.N||8000, CAP=6;

  const λH = PSZ.clamp(0.6+ctx.base.strHome*0.25,0.2,3.5);
  const λA = PSZ.clamp(0.6+ctx.base.strAway*0.25,0.2,3.5);

  const mat=[...Array(CAP+1)].map(()=>Array(CAP+1).fill(0));

  for(let i=0;i<N;i++){
    let h=Math.min(poisson(λH),CAP);
    let a=Math.min(poisson(λA),CAP);
    mat[h][a]++;
  }

  return { matrix:mat, meta:{N,CAP,λH,λA} };
};

})(window.PSZ);
</script>
<script>
(function(PSZ){

PSZ.computeOU = function(res){
  const out={}, lines=[0.5,1.5,2.5,3.5];
  const {matrix,meta:{N,CAP}}=res;
  lines.forEach(l=>{
    let u=0,cut=Math.floor(l);
    for(let h=0;h<=CAP;h++)for(let a=0;a<=CAP;a++)
      if(h+a<=cut)u+=matrix[h][a];
    out[l]={under:u/N,over:1-u/N};
  });
  return out;
};

})(window.PSZ);
</script>
<script>
(function(PSZ){

PSZ.computeConfidence = function(ctx,res){
  let c=Math.max(res.meta.λH,res.meta.λA)*20;
  c-=ctx.auto.volatility*10;
  return PSZ.clamp(c,5,95);
};

})(window.PSZ);
</script>
<script>
(function(PSZ){

PSZ.buildRecommendation = function(ctx,ou,conf){
  return {
    result: conf>=60?"PLAY":"NO BET",
    goals: ou[2.5].over>=0.55?"OVER 2.5":"NO BET",
    btts:"NO BET"
  };
};

PSZ.applyFinalNoBetGate = function(ctx,rec,conf){
  const min=PSZ.resolveLeaguePreset(ctx.leaguePreset).confMin||60;
  if(conf<min) return {result:"NO BET",goals:"NO BET",btts:"NO BET"};
  return rec;
};

})(window.PSZ);
</script>
<script>
(function(PSZ){

PSZ.buildOutputText = function(ctx,res){
  const ou=PSZ.computeOU(res);
  const conf=PSZ.computeConfidence(ctx,res);
  const rec=PSZ.applyFinalNoBetGate(ctx,PSZ.buildRecommendation(ctx,ou,conf),conf);

  return `
MATCH TYPE: ${ctx.matchType}
CONFIDENCE: ${conf.toFixed(1)}%

OU 2.5: ${(ou[2.5].over*100).toFixed(1)}%
RESULT: ${rec.result}
GOALS: ${rec.goals}
`;
};

PSZ.runAnalysis=function(){
  const out=document.getElementById("output");
  try{
    const ctx=PSZ.buildAutoContext();
    const res=PSZ.runMonteCarlo(ctx,{});
    out.textContent=PSZ.buildOutputText(ctx,res);
  }catch(e){
    out.textContent="ERROR: "+e.message;
  }
};

document.addEventListener("DOMContentLoaded",()=>{
  document.getElementById("runEngine")?.addEventListener("click",PSZ.runAnalysis);
});

})(window.PSZ);
</script>
</body>
</html>
